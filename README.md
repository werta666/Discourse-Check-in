# Discourse Check-in Plugin

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Discourseç­¾åˆ°æ’ä»¶ï¼Œæ”¯æŒæ¯æ—¥ç­¾åˆ°ã€ç§¯åˆ†ç³»ç»Ÿã€è¿ç»­ç­¾åˆ°å¥–åŠ±å’Œè¡¥ç­¾æœºåˆ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ¯æ—¥ç­¾åˆ°**: ç”¨æˆ·å¯ä»¥æ¯å¤©ç­¾åˆ°è·å–ç§¯åˆ†å¥–åŠ±
- **ç§¯åˆ†ç³»ç»Ÿ**: ç‹¬ç«‹çš„ç§¯åˆ†è¡¨ç®¡ç†ç”¨æˆ·ç§¯åˆ†
- **è¿ç»­ç­¾åˆ°å¥–åŠ±**: è¿ç»­ç­¾åˆ°è¾¾åˆ°æŒ‡å®šå¤©æ•°å¯è·å¾—é¢å¤–å¥–åŠ±
- **è¡¥ç­¾æœºåˆ¶**: ç”¨æˆ·å¯ä»¥æ¶ˆè€—ç§¯åˆ†è¡¥ç­¾é”™è¿‡çš„æ—¥æœŸ
- **ç­¾åˆ°è®°å½•**: å®Œæ•´çš„ç­¾åˆ°å†å²è®°å½•æŸ¥è¯¢
- **ç®¡ç†å‘˜é…ç½®**: çµæ´»çš„åå°é…ç½®é€‰é¡¹

### ğŸ¨ ç•Œé¢ç‰¹æ€§
- **å“åº”å¼è®¾è®¡**: é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **Discourseé£æ ¼**: å®Œç¾èå…¥Discourseçš„UIè®¾è®¡
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ç•Œé¢
- **å®æ—¶æ›´æ–°**: ç­¾åˆ°çŠ¶æ€å®æ—¶æ›´æ–°

### âš™ï¸ ç®¡ç†åŠŸèƒ½
- **çµæ´»é…ç½®**: ç®¡ç†å‘˜å¯é…ç½®ç­¾åˆ°å¥–åŠ±ã€è¿ç»­å¥–åŠ±ç­‰å‚æ•°
- **æ•°æ®ç»Ÿè®¡**: æŸ¥çœ‹ç­¾åˆ°ç»Ÿè®¡æ•°æ®å’Œç”¨æˆ·æ’è¡Œ
- **ç§¯åˆ†ç®¡ç†**: ç®¡ç†å‘˜å¯æ‰‹åŠ¨è°ƒæ•´ç”¨æˆ·ç§¯åˆ†

## å®‰è£…æŒ‡å—

### æ–¹æ³•ä¸€ï¼šGitå…‹éš†ï¼ˆæ¨èï¼‰

1. è¿›å…¥Discourseçš„pluginsç›®å½•ï¼š
```bash
cd /var/discourse/plugins
```

2. å…‹éš†æ’ä»¶ï¼š
```bash
git clone https://github.com/werta666/Discourse-Check-in.git
```

3. é‡å»ºå®¹å™¨ï¼š
```bash
cd /var/discourse
./launcher rebuild app
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æ’ä»¶æ–‡ä»¶
2. è§£å‹åˆ° `/var/discourse/plugins/discourse-check-in/`
3. é‡å»ºDiscourseå®¹å™¨

## é…ç½®è¯´æ˜

å®‰è£…å®Œæˆåï¼Œè¿›å…¥ç®¡ç†åå° â†’ è®¾ç½® â†’ æ’ä»¶ â†’ Check-in System è¿›è¡Œé…ç½®ï¼š

### åŸºç¡€è®¾ç½®
- **check_in_enabled**: å¯ç”¨/ç¦ç”¨ç­¾åˆ°ç³»ç»Ÿ
- **check_in_daily_points**: æ¯æ—¥ç­¾åˆ°è·å¾—çš„ç§¯åˆ†æ•°é‡ï¼ˆé»˜è®¤ï¼š10ï¼‰

### è¿ç»­ç­¾åˆ°å¥–åŠ±
- **check_in_consecutive_bonus_enabled**: å¯ç”¨è¿ç»­ç­¾åˆ°å¥–åŠ±
- **check_in_consecutive_bonus_days**: è¿ç»­ç­¾åˆ°å¤©æ•°è¦æ±‚ï¼ˆé»˜è®¤ï¼š3å¤©ï¼‰
- **check_in_consecutive_bonus_points**: è¿ç»­ç­¾åˆ°å¥–åŠ±ç§¯åˆ†ï¼ˆé»˜è®¤ï¼š10ï¼‰

### è¡¥ç­¾è®¾ç½®
- **check_in_makeup_enabled**: å¯ç”¨è¡¥ç­¾åŠŸèƒ½
- **check_in_makeup_cost_points**: è¡¥ç­¾æ¶ˆè€—ç§¯åˆ†ï¼ˆé»˜è®¤ï¼š5ï¼‰
- **check_in_makeup_max_days**: æœ€å¤§å¯è¡¥ç­¾å¤©æ•°ï¼ˆé»˜è®¤ï¼š7å¤©ï¼‰

## ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·ä½¿ç”¨

1. **è®¿é—®ç­¾åˆ°é¡µé¢**: ç‚¹å‡»å¯¼èˆªèœå•ä¸­çš„"ç­¾åˆ°"é“¾æ¥
2. **æ¯æ—¥ç­¾åˆ°**: ç‚¹å‡»"ç­¾åˆ°"æŒ‰é’®å®Œæˆå½“æ—¥ç­¾åˆ°
3. **æŸ¥çœ‹è®°å½•**: åˆ‡æ¢åˆ°"è®°å½•"æ ‡ç­¾æŸ¥çœ‹ç­¾åˆ°å†å²
4. **è¡¥ç­¾æ“ä½œ**: åœ¨"è¡¥ç­¾"æ ‡ç­¾ä¸­é€‰æ‹©æ—¥æœŸè¿›è¡Œè¡¥ç­¾

### ç®¡ç†å‘˜æ“ä½œ

1. **æŸ¥çœ‹ç»Ÿè®¡**: è®¿é—® `/check-in/admin/statistics` æŸ¥çœ‹æ•´ä½“æ•°æ®
2. **ç”¨æˆ·ç®¡ç†**: è®¿é—® `/check-in/admin/user-points` ç®¡ç†ç”¨æˆ·ç§¯åˆ†
3. **ç§¯åˆ†è°ƒæ•´**: å¯ä»¥ä¸ºç”¨æˆ·å¢åŠ æˆ–å‡å°‘ç§¯åˆ†

## æ•°æ®åº“ç»“æ„

### è¡¨ç»“æ„

#### user_points (ç”¨æˆ·ç§¯åˆ†è¡¨)
- `user_id`: ç”¨æˆ·ID
- `total_points`: æ€»ç§¯åˆ†
- `created_at`, `updated_at`: æ—¶é—´æˆ³

#### check_in_records (ç­¾åˆ°è®°å½•è¡¨)
- `user_id`: ç”¨æˆ·ID
- `check_in_date`: ç­¾åˆ°æ—¥æœŸ
- `is_makeup`: æ˜¯å¦ä¸ºè¡¥ç­¾
- `points_earned`: è·å¾—ç§¯åˆ†
- `consecutive_days`: è¿ç»­ç­¾åˆ°å¤©æ•°
- `created_at`, `updated_at`: æ—¶é—´æˆ³

#### point_transactions (ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨)
- `user_id`: ç”¨æˆ·ID
- `points`: ç§¯åˆ†å˜åŒ–ï¼ˆæ­£æ•°ä¸ºå¢åŠ ï¼Œè´Ÿæ•°ä¸ºå‡å°‘ï¼‰
- `transaction_type`: äº¤æ˜“ç±»å‹
- `description`: æè¿°
- `check_in_record_id`: å…³è”çš„ç­¾åˆ°è®°å½•ID
- `created_at`, `updated_at`: æ—¶é—´æˆ³

## APIæ¥å£

### ç”¨æˆ·æ¥å£

#### ç­¾åˆ°
```
POST /check-in/check-in
```

#### è¡¥ç­¾
```
POST /check-in/makeup-check-in
å‚æ•°: { date: "2024-01-01" }
```

#### è·å–ç­¾åˆ°çŠ¶æ€
```
GET /check-in/check-in-status
```

#### è·å–ç­¾åˆ°è®°å½•
```
GET /check-in/check-in-records?page=1&per_page=20
```

#### è·å–ç§¯åˆ†ä¿¡æ¯
```
GET /check-in/points
```

#### è·å–ç§¯åˆ†äº¤æ˜“è®°å½•
```
GET /check-in/point-transactions?page=1&per_page=20&type=check_in
```

### ç®¡ç†å‘˜æ¥å£

#### è·å–ç»Ÿè®¡æ•°æ®
```
GET /check-in/admin/statistics
```

#### è·å–ç”¨æˆ·ç§¯åˆ†åˆ—è¡¨
```
GET /check-in/admin/user-points?page=1&per_page=20&search=username
```

#### è°ƒæ•´ç”¨æˆ·ç§¯åˆ†
```
POST /check-in/admin/adjust-points
å‚æ•°: { user_id: 1, points: 100, reason: "ç®¡ç†å‘˜è°ƒæ•´" }
```

## å¼€å‘ä¿¡æ¯

### æŠ€æœ¯æ ˆ
- **åç«¯**: Ruby on Rails 7.0+
- **å‰ç«¯**: Ember.js (Discourseç‰ˆæœ¬)
- **æ•°æ®åº“**: PostgreSQL
- **æ ·å¼**: SCSS

### æ–‡ä»¶ç»“æ„
```
discourse-check-in/
â”œâ”€â”€ plugin.rb                          # æ’ä»¶ä¸»æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ routes.rb                      # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ settings.yml                   # è®¾ç½®é…ç½®
â”‚   â””â”€â”€ locales/                       # è¯­è¨€æ–‡ä»¶
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ models/                        # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ controllers/                   # æ§åˆ¶å™¨
â”‚   â””â”€â”€ services/                      # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ javascripts/discourse/         # å‰ç«¯JSæ–‡ä»¶
â”‚   â””â”€â”€ stylesheets/                   # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ db/migrate/                        # æ•°æ®åº“è¿ç§»
â””â”€â”€ spec/                             # æµ‹è¯•æ–‡ä»¶
```

## å…¼å®¹æ€§

- **Discourseç‰ˆæœ¬**: 2.7.0+
- **Rubyç‰ˆæœ¬**: 2.7+
- **Railsç‰ˆæœ¬**: 7.0+

## è®¸å¯è¯

MIT License

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueåˆ°GitHubä»“åº“ï¼š
https://github.com/werta666/Discourse-Check-in/issues

## æ›´æ–°æ—¥å¿—

### v0.1.0 (2024-01-XX)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- å®ç°åŸºç¡€ç­¾åˆ°åŠŸèƒ½
- æ·»åŠ ç§¯åˆ†ç³»ç»Ÿ
- æ”¯æŒè¿ç»­ç­¾åˆ°å¥–åŠ±
- å®ç°è¡¥ç­¾æœºåˆ¶
- æ·»åŠ ç®¡ç†å‘˜é…ç½®ç•Œé¢
- æ”¯æŒä¸­è‹±æ–‡åŒè¯­

<div class="check-in-page">
  <div class="container">
    <h1><%= t('check_in.title') %></h1>
    
    <div class="check-in-content">
      <div class="check-in-info">
        <h3><%= t('check_in.total_points') %>: <span id="total-points">0</span></h3>
        <p id="status-message"><%= t('check_in.status.ready_to_check_in') %></p>
      </div>
      
      <div class="check-in-action">
        <button id="check-in-btn" class="btn btn-primary">
          <%= t('check_in.button.check_in') %>
        </button>
      </div>
      
      <div id="message-area" style="display: none;">
        <div class="alert alert-success" id="success-message"></div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const checkInBtn = document.getElementById('check-in-btn');
  const messageArea = document.getElementById('message-area');
  const successMessage = document.getElementById('success-message');
  const totalPoints = document.getElementById('total-points');
  const statusMessage = document.getElementById('status-message');
  
  // Load initial status
  loadStatus();
  
  checkInBtn.addEventListener('click', function() {
    if (checkInBtn.disabled) return;
    
    checkInBtn.disabled = true;
    checkInBtn.textContent = '<%= t('check_in.button.checking_in') %>';
    
    fetch('/check-in/check-in', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        successMessage.textContent = '<%= t('check_in.success.checked_in') %> +' + data.data.points_earned + ' <%= t('check_in.points') %>';
        messageArea.style.display = 'block';
        loadStatus();
      } else {
        alert('<%= t('check_in.errors.general') %>');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('<%= t('check_in.errors.general') %>');
    })
    .finally(() => {
      checkInBtn.disabled = false;
      checkInBtn.textContent = '<%= t('check_in.button.check_in') %>';
    });
  });
  
  function loadStatus() {
    fetch('/check-in/check-in-status')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        totalPoints.textContent = data.data.total_points;
        if (data.data.checked_in_today) {
          statusMessage.textContent = '<%= t('check_in.status.checked_in_today') %>';
          checkInBtn.textContent = '<%= t('check_in.button.checked_in') %>';
          checkInBtn.disabled = true;
          checkInBtn.classList.add('btn-success');
          checkInBtn.classList.remove('btn-primary');
        }
      }
    })
    .catch(error => {
      console.error('Error loading status:', error);
    });
  }
});
</script>

<style>
.check-in-page {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.check-in-content {
  background: #f9f9f9;
  padding: 30px;
  border-radius: 8px;
  text-align: center;
}

.check-in-info {
  margin-bottom: 30px;
}

.check-in-info h3 {
  font-size: 24px;
  margin-bottom: 10px;
}

#total-points {
  color: #007cba;
  font-weight: bold;
}

.check-in-action {
  margin-bottom: 20px;
}

#check-in-btn {
  font-size: 18px;
  padding: 12px 30px;
  min-width: 150px;
}

#message-area {
  margin-top: 20px;
}

.alert {
  padding: 15px;
  border-radius: 4px;
  margin-bottom: 20px;
}

.alert-success {
  background-color: #d4edda;
  border-color: #c3e6cb;
  color: #155724;
}
</style>
